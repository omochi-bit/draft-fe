# PRD（Product Requirements Document）

## プロダクト概要

### 目的
ユーザーがタスク管理を効率的に行えるTODO管理のWebアプリケーションを提供する。  
タグによる分類を可能とし、ユーザーごとに独立したデータ領域を持つ。

### ターゲットユーザー
- 個人学習者
- 生産性向上を目的とした一般ユーザー
- 小規模プロジェクトの個人利用

### プラットフォーム
- Webアプリケーション
- PC / モバイルブラウザ対応

---

## 機能一覧

### 1. ユーザー認証
- メールアドレス＋パスワードでサインアップ
- ログイン / ログアウト
- パスワードリセット
- 認証済みユーザーのみアプリにアクセス可能
- 各ユーザーのデータは完全に分離

### 2. タスク管理機能

#### タスク一覧表示
- ログインユーザーのタスクのみ表示
- 表示項目: タイトル, ステータス（未完了 / 完了）, 作成日時, 紐づくタグ（複数）
- フィルタ: 未完了 / 完了, タグフィルタ（指定タグに紐づくタスクのみ表示）
- 並び順: 作成日降順（デフォルト）

#### タスク登録
- 入力項目: タイトル（必須）, 説明（任意）, タグ（複数選択可）
- 登録後は一覧へ即時反映

#### タスク詳細
- 表示項目: タイトル, 説明, ステータス, タグ, 作成日時, 更新日時

#### タスク編集
- 編集可能項目: タイトル, 説明, ステータス, タグ（複数）

#### タスク削除
- 削除確認ダイアログの表示
- 削除後に一覧から除去

#### 完了フラグ変更
- 一覧からワンクリックで「未完了 ⇄ 完了」に切り替え可能

### 3. タグ管理機能

#### タグ一覧表示
- ユーザーが作成したタグ一覧を表示
- 表示項目: タグ名, 作成日時

#### タグ作成
- 入力項目: タグ名（必須／ユニーク）

#### タグ編集
- タグ名変更（重複不可）

#### タグ削除
- タグを削除すると Task と Tag の紐づき関係も削除される
- タスクそのものは削除されない

---

## 非機能要件
TODO
### 1. セキュリティ
### 認証・認可

認証方式は以下のいずれかを採用する（開発者の技術スタックに準拠）

JWT（Access Token / Refresh Token）

Cookie + セッション方式（HTTPOnly Cookie 推奨）

Signup / Login を除くすべての API は認証必須とする

API リクエストの userId はトークンの claims から取得し、
URL やリクエストボディの userId は信用しない

### パスワード管理
- パスワードは 平文保存禁止
- ハッシュ方式はbcrypt推奨

### 通信の安全性
- すべて HTTPS 前提
- HTTP 経由のアクセスは HTTPS へリダイレクトする

### 1.4 入力バリデーション

バックエンドは必ず サーバー側バリデーションを行う
クライアントのバリデーションは UX 向上目的であり、信頼はしない

### 1.5 主要脅威への対策
脅威	対策
XSS	エスケープ処理、Content-Security-Policy、HTMLテンプレートで unsafe 操作禁止
CSRF	JWT なら token 方式、Cookie なら SameSite=Lax/Strict
SQL Injection	ORM 使用、パラメータバインド必須
セッションハイジャック	Token の短寿命化、セキュアクッキー
ブルートフォース攻撃	ログイン試行制限、Rate Limit

- 認証必須
- パスワードはハッシュ化して保存
- 各ユーザーのタスク・タグは分離
- CSRF / XSS / インジェクション対策

### 2. パフォーマンス

#### レスポンス性能
- API レスポンスは 300ms以内（ネットワーク時間除く）
- Task一覧はユーザー単位で 最大200件 まで想定
- タグは 最大30件

### DBパフォーマンス
- Task → Tag の参照は N+1 を避ける
- JOIN または JOIN TABLE による1クエリでの取得を推奨
- TaskTag テーブルには以下のインデックスを必須とする
  - taskId
  - tagId

### クライアントパフォーマンス
- 初回ロードは 3秒以内
- JS バンドルは必要最小限（Lazy Load 推奨）
- SPA環境ではルーティングキャッシュ可

### 拡張性
- プロジェクト機能
- タグカラー管理
- カレンダー機能
- 通知機能などを追加可能な構造とする


## 3. 可用性要件

### リトライ戦略
クライアント側は以下の条件で自動リトライを行う
- ネットワークエラー
- 5xx エラー

バックエンドは DB リトライを 1 回まで許容

### 過負荷対策
API レートリミット：IP またはユーザー単位で 1分間に100リクエスト程度

## 拡張性要件
### 水平スケールの容易性
アプリケーションロジックはステートレス（セッション情報は外部ストレージ）
ファイルアップロードを行わないためサーバーの状態依存なし

## 運用要件

### ログ要件
- 必須ログ（INFO）
  - Auth: 成功・失敗
  - Task: 作成・更新・削除
  - Tag: 作成・更新・削除
- 禁止ログ
  - パスワード
  - Token（完全表示）
  - 個人情報
  - センシティブなエラースタック

## 信頼性要件

### トランザクション管理
Task / Tag の CRUD は基本単体操作
Task と Tag の紐づけ変更は トランザクションで一括更新必須

## ユーザビリティ要件
- 入力エラーはフィールド単位で明示的に表示
- タスク作成/編集後は自動で一覧へ戻る
- タグの作成/編集後は TagList に戻る
- タスク完了操作はワンクリックで実施

## ローカライズ要件
- 日付は YYYY-MM-DD HH:mm 表記
- タイムゾーンはユーザー環境に依存
- サーバー側は UTC で保存

---

## UI/UX 仕様

### 画面一覧
| 画面         | 説明                          |
|--------------|-------------------------------|
| ログイン     | メール・パスワードでログイン   |
| サインアップ | アカウント作成                 |
| タスク一覧   | タスク表示・フィルタ・ステータス変更 |
| タスク作成   | 新規タスク登録                 |
| タスク詳細   | タスクの内容確認               |
| タスク編集   | タスク内容の編集               |
| タグ一覧     | マイタグの一覧表示             |
| タグ作成・編集 | タグの作成／編集              |
